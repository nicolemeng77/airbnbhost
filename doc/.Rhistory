square_feet, price, weekly_price, cleaning_fee, minimum_nights, availability_365,
number_of_reviews, instant_bookable, cancellation_policy,
require_guest_phone_verification,
host_response_time, host_verifications, security_deposit)
#host_has_profile_pic,  host_identity_verified
#or just read the condensed listings(with different filters)
#data = read.csv("listings_condensed.csv",header = T)
nrow(data)
colnames(data)
#rename variable
data <- data %>%
rename(neighbourhood = neighbourhood_cleansed,
neighbourhood_group = neighbourhood_group_cleansed)
#data structure
data <- data %>%
mutate_if(is.logical, as.numeric) %>% # convert True False to 1,0
mutate_at(c("neighbourhood", "neighbourhood_group", "property_type",
"room_type", "bed_type", "cancellation_policy", 'host_is_superhost',
'host_identity_verified', 'instant_bookable', 'require_guest_phone_verification',
'host_response_time'),
as.factor)
#edit data value
convert_price <- function(x) as.numeric(gsub("\\$|,", "", x))
string_split <- function(x) str_split(gsub("\\{|\\}|\"", "", x),",")
data <- data %>%
mutate_at(c("price", "weekly_price", "cleaning_fee", "security_deposit"), convert_price) %>%
mutate_at("amenities", string_split) %>%
mutate_at('host_verifications', string_split) %>%
mutate(hosted_years = round(as.double(difftime(Sys.Date(), host_since)) / 365, 1))
data <- data %>%
mutate(number_of_amenities = lengths(amenities)) %>%
mutate(number_of_verifications = lengths(host_verifications))
#amenity
data <- data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0)) %>%
mutate(have_washer = ifelse(grepl("washer", data$amenities), 1, 0)) %>%
mutate(have_kitchen = ifelse(grepl("kitchen", data$amenities), 1, 0)) %>%
mutate(have_parking = ifelse(grepl("parking", data$amenities), 1, 0)) %>%
mutate(have_elevator = ifelse(grepl("elevator", data$amenities), 1, 0)) %>%
mutate(have_laptop_workspac = ifelse(grepl("Laptop friendly workspace", data$amenities), 1, 0)) %>%
#property_type (combine factors)
data <- data.table(data)
data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name))
data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name))
data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit)))
data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0))
#edit data value
convert_price <- function(x) as.numeric(gsub("\\$|,", "", x))
string_split <- function(x) str_split(gsub("\\{|\\}|\"", "", x),",")
data <- data %>%
mutate_at(c("price", "weekly_price", "cleaning_fee", "security_deposit"), convert_price) %>%
mutate_at("amenities", string_split) %>%
mutate_at('host_verifications', string_split) %>%
mutate(hosted_years = round(as.double(difftime(Sys.Date(), host_since)) / 365, 1))
data <- data %>%
mutate(number_of_amenities = lengths(amenities)) %>%
mutate(number_of_verifications = lengths(host_verifications))
#amenity
data <- data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0)) %>%
mutate(have_washer = ifelse(grepl("washer", data$amenities), 1, 0)) %>%
mutate(have_kitchen = ifelse(grepl("kitchen", data$amenities), 1, 0)) %>%
mutate(have_parking = ifelse(grepl("parking", data$amenities), 1, 0)) %>%
mutate(have_elevator = ifelse(grepl("elevator", data$amenities), 1, 0)) %>%
mutate(have_laptop_workspac = ifelse(grepl("Laptop friendly workspace", data$amenities), 1, 0))
#property_type (combine factors)
data <- data.table(data)
data <- data[property_type %in% c("Barn", "Bed and breakfast", "Boat", "Bungalow","Bus","Cabin","Camper/RV","Casa particular (Cuba)", "Castle","Cave","Cottage","Dome house","Earth house","Farm stay","Houseboat","Island","Nature lodge","Other","Tent","Timeshare","Tiny house","Yurt"), property_type:= "Others"]
data <- data[property_type %in% c("Townhouse", "House", "Guesthouse", "Resort","Villa","Tiny house"), property_type:= "House"]
data <- data[property_type %in% c("Apartment","Condominium","Guest suite","Serviced apartment"), property_type:= "Apartment"]
data <- data[property_type %in% c("Hostel","Hotel","Boutique hotel","Aparthotel"), property_type:= "Hotel"]
table(data$property_type)
data <- data[grepl("loft", data$name), property_type := "Loft"]
table(data$property_type)
nrow(data)
data <- data[property_type != "Others"]
nrow(data)
# Outliers
# need to check: accommodates, bathrooms, bedrooms, beds, price, cleaning_fee, minimum_nights, number_of_reviews...
# ATTENTION many 0 bedroom!
nrow(data)  #48377
# nrow(data %>% filter(beds > 20)) #5
# nrow(data %>% filter(bedrooms > 20)) #1
# nrow(data %>% filter(bedrooms == 1 & bathrooms > 4)) #39    ##1 bedroom & 3+ bathrooms usually comes with price under 100
# nrow(data %>% filter(price > 1500)) #137
# nrow(data %>% filter(cleaning_fee > 200 & minimum_nights < 30)) #381   ##prefer not to use cleaning_fee
# nrow(data %>% filter(minimum_nights > 90)) #361
# hist(data$number_of_reviews)
# hist(data$hosted_years)
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90)
nrow(data)  #37987
hist(data$security_deposit)
data %>% filter(security_deposit > 1000) %>% select(security_deposit)
data %>% filter(security_deposit > 1000)
data %>% filter(security_deposit > 1000) %>% select(security_deposit)
data %>% filter(security_deposit > 1000) dplyr::%>% select(security_deposit)
data %>% filter(security_deposit > 1000) %>% dplyr::select(security_deposit)
View(data)
data %>% filter(security_deposit > 3000) %>% dplyr::select(security_deposit)
data %>% filter(security_deposit > 3000) %>% dplyr::select(security_deposit, price)
data %>% filter(security_deposit > 3000) %>% dplyr::select(security_deposit, price, minimum_nights)
data %>% filter(security_deposit > 3000) %>% dplyr::select(security_deposit, price, minimum_nights, number_of_reviews)
load("../data/orig_data.RData")
library(tidyverse)
library(MASS)
#library(scales)
library(data.table)
#ignore useless variables
data <- orig_data %>% dplyr::select(id,name,description, transit, house_rules, host_since, host_is_superhost,
host_listings_count, host_identity_verified, neighbourhood_cleansed,
neighbourhood_group_cleansed, zipcode, latitude, longitude, property_type,
room_type, accommodates, bathrooms, bedrooms, beds,bed_type, amenities,
square_feet, price, weekly_price, cleaning_fee, minimum_nights, availability_365,
number_of_reviews, instant_bookable, cancellation_policy,
require_guest_phone_verification,
host_response_time, host_verifications, security_deposit)
#host_has_profile_pic,  host_identity_verified
#or just read the condensed listings(with different filters)
#data = read.csv("listings_condensed.csv",header = T)
nrow(data)
colnames(data)
#rename variable
data <- data %>%
rename(neighbourhood = neighbourhood_cleansed,
neighbourhood_group = neighbourhood_group_cleansed)
#data structure
data <- data %>%
mutate_if(is.logical, as.numeric) %>% # convert True False to 1,0
mutate_at(c("neighbourhood", "neighbourhood_group", "property_type",
"room_type", "bed_type", "cancellation_policy", 'host_is_superhost',
'host_identity_verified', 'instant_bookable', 'require_guest_phone_verification',
'host_response_time'),
as.factor)
#edit data value
convert_price <- function(x) as.numeric(gsub("\\$|,", "", x))
string_split <- function(x) str_split(gsub("\\{|\\}|\"", "", x),",")
data <- data %>%
mutate_at(c("price", "weekly_price", "cleaning_fee", "security_deposit"), convert_price) %>%
mutate_at("amenities", string_split) %>%
mutate_at('host_verifications', string_split) %>%
mutate(hosted_years = round(as.double(difftime(Sys.Date(), host_since)) / 365, 1))
data <- data %>%
mutate(number_of_amenities = lengths(amenities)) %>%
mutate(number_of_verifications = lengths(host_verifications))
#amenity
data <- data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0)) %>%
mutate(have_washer = ifelse(grepl("washer", data$amenities), 1, 0)) %>%
mutate(have_kitchen = ifelse(grepl("kitchen", data$amenities), 1, 0)) %>%
mutate(have_parking = ifelse(grepl("parking", data$amenities), 1, 0)) %>%
mutate(have_elevator = ifelse(grepl("elevator", data$amenities), 1, 0)) %>%
mutate(have_laptop_workspac = ifelse(grepl("Laptop friendly workspace", data$amenities), 1, 0))
#property_type (combine factors)
data <- data.table(data)
data <- data[property_type %in% c("Barn", "Bed and breakfast", "Boat", "Bungalow","Bus","Cabin","Camper/RV","Casa particular (Cuba)", "Castle","Cave","Cottage","Dome house","Earth house","Farm stay","Houseboat","Island","Nature lodge","Other","Tent","Timeshare","Tiny house","Yurt"), property_type:= "Others"]
data <- data[property_type %in% c("Townhouse", "House", "Guesthouse", "Resort","Villa","Tiny house"), property_type:= "House"]
data <- data[property_type %in% c("Apartment","Condominium","Guest suite","Serviced apartment"), property_type:= "Apartment"]
data <- data[property_type %in% c("Hostel","Hotel","Boutique hotel","Aparthotel"), property_type:= "Hotel"]
table(data$property_type)
data <- data[grepl("loft", data$name), property_type := "Loft"]
table(data$property_type)
nrow(data)
data <- data[property_type != "Others"]
nrow(data)
# Outliers
# need to check: accommodates, bathrooms, bedrooms, beds, price, cleaning_fee, minimum_nights, number_of_reviews...
### ATTENTION many 0 bedroom!
### ATTENTION many outliers in security_deposit
nrow(data)  #48377
# nrow(data %>% filter(beds > 20)) #5
# nrow(data %>% filter(bedrooms > 20)) #1
# nrow(data %>% filter(bedrooms == 1 & bathrooms > 4)) #39    ##1 bedroom & 3+ bathrooms usually comes with price under 100
# nrow(data %>% filter(price > 1500)) #137
# nrow(data %>% filter(cleaning_fee > 200 & minimum_nights < 30)) #381   ##prefer not to use cleaning_fee
# nrow(data %>% filter(minimum_nights > 90)) #361
# hist(data$number_of_reviews)
# hist(data$hosted_years)
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90)
nrow(data)  #37987
# Outliers
# need to check: accommodates, bathrooms, bedrooms, beds, price, cleaning_fee, minimum_nights, number_of_reviews...
### ATTENTION many 0 bedroom!
### ATTENTION many outliers in security_deposit
nrow(data)  #48377
# nrow(data %>% filter(beds > 20)) #5
# nrow(data %>% filter(bedrooms > 20)) #1
# nrow(data %>% filter(bedrooms == 1 & bathrooms > 4)) #39    ##1 bedroom & 3+ bathrooms usually comes with price under 100
# nrow(data %>% filter(price > 1500)) #137
# nrow(data %>% filter(cleaning_fee > 200 & minimum_nights < 30)) #381   ##prefer not to use cleaning_fee
# nrow(data %>% filter(minimum_nights > 90)) #361
# hist(data$number_of_reviews)
# hist(data$hosted_years)
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90)
#havn't decided
data <- data[property_type != "Others"]
data <- data[property_type != "Others"]
data <- data[property_type %in% c("Hostel","Hotel","Boutique hotel","Aparthotel"), property_type:= "Hotel"]
load("../data/orig_data.RData")
library(tidyverse)
library(MASS)
#library(scales)
library(data.table)
#ignore useless variables
data <- orig_data %>% dplyr::select(id,name,description, transit, house_rules, host_since, host_is_superhost,
host_listings_count, host_identity_verified, neighbourhood_cleansed,
neighbourhood_group_cleansed, zipcode, latitude, longitude, property_type,
room_type, accommodates, bathrooms, bedrooms, beds,bed_type, amenities,
square_feet, price, weekly_price, cleaning_fee, minimum_nights, availability_365,
number_of_reviews, instant_bookable, cancellation_policy,
require_guest_phone_verification,
host_response_time, host_verifications, security_deposit)
#host_has_profile_pic,  host_identity_verified
#or just read the condensed listings(with different filters)
#data = read.csv("listings_condensed.csv",header = T)
nrow(data)
colnames(data)
#rename variable
data <- data %>%
rename(neighbourhood = neighbourhood_cleansed,
neighbourhood_group = neighbourhood_group_cleansed)
#data structure
data <- data %>%
mutate_if(is.logical, as.numeric) %>% # convert True False to 1,0
mutate_at(c("neighbourhood", "neighbourhood_group", "property_type",
"room_type", "bed_type", "cancellation_policy", 'host_is_superhost',
'host_identity_verified', 'instant_bookable', 'require_guest_phone_verification',
'host_response_time'),
as.factor)
#edit data value
convert_price <- function(x) as.numeric(gsub("\\$|,", "", x))
string_split <- function(x) str_split(gsub("\\{|\\}|\"", "", x),",")
data <- data %>%
mutate_at(c("price", "weekly_price", "cleaning_fee", "security_deposit"), convert_price) %>%
mutate_at("amenities", string_split) %>%
mutate_at('host_verifications', string_split) %>%
mutate(hosted_years = round(as.double(difftime(Sys.Date(), host_since)) / 365, 1))
data <- data %>%
mutate(number_of_amenities = lengths(amenities)) %>%
mutate(number_of_verifications = lengths(host_verifications))
#amenity
data <- data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0)) %>%
mutate(have_washer = ifelse(grepl("washer", data$amenities), 1, 0)) %>%
mutate(have_kitchen = ifelse(grepl("kitchen", data$amenities), 1, 0)) %>%
mutate(have_parking = ifelse(grepl("parking", data$amenities), 1, 0)) %>%
mutate(have_elevator = ifelse(grepl("elevator", data$amenities), 1, 0)) %>%
mutate(have_laptop_workspac = ifelse(grepl("Laptop friendly workspace", data$amenities), 1, 0))
#property_type (combine factors)
data <- data.table(data)
data <- data[property_type %in% c("Barn", "Bed and breakfast", "Boat", "Bungalow","Bus","Cabin","Camper/RV","Casa particular (Cuba)", "Castle","Cave","Cottage","Dome house","Earth house","Farm stay","Houseboat","Island","Nature lodge","Other","Tent","Timeshare","Tiny house","Yurt"), property_type:= "Others"]
data <- data[property_type %in% c("Townhouse", "House", "Guesthouse", "Resort","Villa","Tiny house"), property_type:= "House"]
data <- data[property_type %in% c("Apartment","Condominium","Guest suite","Serviced apartment"), property_type:= "Apartment"]
data <- data[property_type %in% c("Hostel","Hotel","Boutique hotel","Aparthotel"), property_type:= "Hotel"]
data <- data[grepl("loft", data$name), property_type := "Loft"]
data <- data[property_type != "Others"]
# Outliers
# need to check: accommodates, bathrooms, bedrooms, beds, price, cleaning_fee, minimum_nights, number_of_reviews...
### ATTENTION many 0 bedroom!
### ATTENTION many outliers in security_deposit
nrow(data)  #48377
# nrow(data %>% filter(beds > 20)) #5
# nrow(data %>% filter(bedrooms > 20)) #1
# nrow(data %>% filter(bedrooms == 1 & bathrooms > 4)) #39    ##1 bedroom & 3+ bathrooms usually comes with price under 100
# nrow(data %>% filter(price > 1500)) #137
# nrow(data %>% filter(cleaning_fee > 200 & minimum_nights < 30)) #381   ##prefer not to use cleaning_fee
# nrow(data %>% filter(minimum_nights > 90)) #361
# hist(data$number_of_reviews)
# hist(data$hosted_years)
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90)
nrow(data)  #37987
load("../data/orig_data.RData")
library(tidyverse)
library(MASS)
#library(scales)
library(data.table)
#ignore useless variables
data <- orig_data %>% dplyr::select(id,name,description, transit, house_rules, host_since, host_is_superhost,
host_listings_count, host_identity_verified, neighbourhood_cleansed,
neighbourhood_group_cleansed, zipcode, latitude, longitude, property_type,
room_type, accommodates, bathrooms, bedrooms, beds,bed_type, amenities,
square_feet, price, weekly_price, cleaning_fee, minimum_nights, availability_365,
number_of_reviews, instant_bookable, cancellation_policy,
require_guest_phone_verification,
host_response_time, host_verifications, security_deposit)
#host_has_profile_pic,  host_identity_verified
#or just read the condensed listings(with different filters)
#data = read.csv("listings_condensed.csv",header = T)
nrow(data)
colnames(data)
#rename variable
data <- data %>%
rename(neighbourhood = neighbourhood_cleansed,
neighbourhood_group = neighbourhood_group_cleansed)
#data structure
data <- data %>%
mutate_if(is.logical, as.numeric) %>% # convert True False to 1,0
mutate_at(c("neighbourhood", "neighbourhood_group", "property_type",
"room_type", "bed_type", "cancellation_policy", 'host_is_superhost',
'host_identity_verified', 'instant_bookable', 'require_guest_phone_verification',
'host_response_time'),
as.factor)
#edit data value
convert_price <- function(x) as.numeric(gsub("\\$|,", "", x))
string_split <- function(x) str_split(gsub("\\{|\\}|\"", "", x),",")
data <- data %>%
mutate_at(c("price", "weekly_price", "cleaning_fee", "security_deposit"), convert_price) %>%
mutate_at("amenities", string_split) %>%
mutate_at('host_verifications', string_split) %>%
mutate(hosted_years = round(as.double(difftime(Sys.Date(), host_since)) / 365, 1))
data <- data %>%
mutate(number_of_amenities = lengths(amenities)) %>%
mutate(number_of_verifications = lengths(host_verifications))
#amenity
data <- data %>%
mutate(amenities = tolower(amenities)) %>%
mutate(house_rules = tolower(house_rules)) %>%
mutate(name = tolower(name)) %>%
mutate(transit_level = as.numeric(is.na(transit))) %>%  #1:has description, 0:NA
mutate(rule_Pets = ifelse(grepl("no pets", data$house_rules), 0, 1)) %>%
mutate(have_pet = ifelse(grepl("cat", data$amenities) |
grepl("dog", data$amenities) |
grepl("pet", data$amenities), 1, 0)) %>%
mutate(have_shampoo = ifelse(grepl("shampoo", data$amenities), 1, 0)) %>%
mutate(have_gym = ifelse(grepl("gym", data$amenities), 1, 0)) %>%
mutate(have_washer = ifelse(grepl("washer", data$amenities), 1, 0)) %>%
mutate(have_kitchen = ifelse(grepl("kitchen", data$amenities), 1, 0)) %>%
mutate(have_parking = ifelse(grepl("parking", data$amenities), 1, 0)) %>%
mutate(have_elevator = ifelse(grepl("elevator", data$amenities), 1, 0)) %>%
mutate(have_laptop_workspac = ifelse(grepl("Laptop friendly workspace", data$amenities), 1, 0))
#property_type (combine factors)
data <- data.table(data)
data <- data[property_type %in% c("Barn", "Bed and breakfast", "Boat", "Bungalow","Bus","Cabin","Camper/RV","Casa particular (Cuba)", "Castle","Cave","Cottage","Dome house","Earth house","Farm stay","Houseboat","Island","Nature lodge","Other","Tent","Timeshare","Tiny house","Yurt"), property_type:= "Others"]
data <- data[property_type %in% c("Townhouse", "House", "Guesthouse", "Resort","Villa","Tiny house"), property_type:= "House"]
data <- data[property_type %in% c("Apartment","Condominium","Guest suite","Serviced apartment"), property_type:= "Apartment"]
data <- data[property_type %in% c("Hostel","Hotel","Boutique hotel","Aparthotel"), property_type:= "Hotel"]
data <- data[grepl("loft", data$name), property_type := "Loft"]
# Outliers
# need to check: accommodates, bathrooms, bedrooms, beds, price, cleaning_fee, minimum_nights, number_of_reviews...
### ATTENTION many 0 bedroom!
### ATTENTION many outliers in security_deposit
nrow(data)  #48377
# nrow(data %>% filter(beds > 20)) #5
# nrow(data %>% filter(bedrooms > 20)) #1
# nrow(data %>% filter(bedrooms == 1 & bathrooms > 4)) #39    ##1 bedroom & 3+ bathrooms usually comes with price under 100
# nrow(data %>% filter(price > 1500)) #137
# nrow(data %>% filter(cleaning_fee > 200 & minimum_nights < 30)) #381   ##prefer not to use cleaning_fee
# nrow(data %>% filter(minimum_nights > 90)) #361
# hist(data$number_of_reviews)
# hist(data$hosted_years)
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90)
###havn't decided
data <- data[property_type != "Others"]
data <- data  %>%
filter(beds <= 20, bedrooms <= 20,
bedrooms != 1 | bathrooms <= 4,
price < 1500 & price > 0,
cleaning_fee <= 200 | minimum_nights >= 30,
minimum_nights <= 90) %>%
filter(property_type != "Others") #havn't decided
nrow(data)  #37987
#check missing value
colSums(is.na(data))
# data <- data %>%
#   select(-c(weekly_price, square_feet, security_deposit))
#linear regression
fit1 <- lm(price ~ host_is_superhost + bathrooms + bedrooms + beds + number_of_reviews + instant_bookable + require_guest_phone_verification + hosted_years + number_of_amenities, data)
summary(fit1)
#Adjusted R-squared:  0.2092
#multicollinearity
car::vif(fit1)
data <- data %>%
mutate(if_Manhattan = ifelse(data$neighbourhood_group == 'Manhattan', 1, 0)) %>%
mutate(if_Brooklyn = ifelse(data$neighbourhood_group == 'Brooklyn', 1, 0)) %>%
mutate(if_Queens = ifelse(data$neighbourhood_group == 'Queens', 1, 0)) %>%
mutate(if_Bronx = ifelse(data$neighbourhood_group == 'Bronx', 1, 0))
fit2 <- lm(price ~ bathrooms + bedrooms + beds + number_of_reviews +
hosted_years + number_of_amenities + if_Manhattan + if_Brooklyn + if_Queens + if_Bronx, data)
summary(fit2)
#Adjusted R-squared:  0.3295
car::vif(fit2)
#robust regression?  ##no conclusion
fit3 <- rlm(price ~ bathrooms + bedrooms + beds + number_of_reviews +
hosted_years + number_of_amenities + if_Manhattan + if_Brooklyn + if_Queens + if_Bronx, data)
summary(fit3)
#other method...
###neighbourhood_group###
# % of 5 boroughs
dat2 <- data.table(data)
neighb_count <- dat2[, .N, keyby = neighbourhood_group] %>%
mutate(percent = percent(N / sum(N))) %>%
mutate(label = paste(neighbourhood_group, percent))
library(scales)
###neighbourhood_group###
# % of 5 boroughs
dat2 <- data.table(data)
neighb_count <- dat2[, .N, keyby = neighbourhood_group] %>%
mutate(percent = percent(N / sum(N))) %>%
mutate(label = paste(neighbourhood_group, percent))
pie(neighb_count$N, neighb_count$label)
# average price in 5 boroughs
price_avg <- dat2 %>% group_by(neighbourhood_group) %>%
summarise(Avg_price = round(mean(price, na.rm = T),2), N = n())
setorderv(price_avg, "Avg_price",order = -1)
price_avg
#bar plot
barplot(price_avg$Avg_price, names.arg = price_avg$neighbourhood_group, ylim = c(0,200))
text(x = c(0.7,1.9,3.1,4.2,5.5), y = price_avg$Avg_price + 6, labels = paste("$", price_avg$Avg_price))
#hist of price in 5 boroughs
data %>% ggplot(aes(price, color = neighbourhood_group)) + geom_freqpoly()
#boxplot
data %>% ggplot(aes(fct_reorder(neighbourhood_group, -price), price, color = neighbourhood_group)) + geom_boxplot()
#Wilcoxon rank-sum test
kruskal.test(price ~ neighbourhood_group, data)
#the price in at least one borough is different from others
wilcox.test(data[data$neighbourhood_group == 'Manhattan',]$price,
data[data$neighbourhood_group == 'Brooklyn',]$price)
wilcox.test(data[data$neighbourhood_group == 'Brooklyn',]$price,
data[data$neighbourhood_group == 'Staten Island',]$price)
wilcox.test(data[data$neighbourhood_group == 'Staten Island',]$price,
data[data$neighbourhood_group == 'Queens',]$price)
#p-value = 0.3391, no significant difference in these two boroughs.
###neighbourhood###
dat_m <- dat2[neighbourhood_group %in% c("Manhattan", "Brooklyn")]
m_count <- dat_m[,.N,keyby = neighbourhood]
setorderv(m_count,"N",order = -1)
m_count
barplot(m_count$N[1:5], names.arg = m_count$neighbourhood[1:5],cex.names = 0.9)
